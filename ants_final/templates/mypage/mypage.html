<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>마이페이지</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background-color: #f4f4f4;
            margin: 0;
            padding: 0;
        }

        h1,
        h3 {
            text-align: center;
            color: #333;
            margin-top: 20px;
        }

        .section {
            margin: 20px auto;
            max-width: 600px;
            padding: 20px;
            background-color: #fff;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .stock-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .stock-list li {
            background-color: #fff;
            border-radius: 10px;
            margin-bottom: 15px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .stock-list li:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            transform: translateY(-2px);
            transition: all 0.3s ease;
        }

        .stock-code {
            font-weight: bold;
            font-size: 1.2em;
            color: #007bff;
        }

        .stock-price {
            font-size: 1.1em;
            color: #28a745;
        }

        .stock-rate {
            color: #dc3545;
        }

        .btn-save {
            display: block;
            margin: 20px auto;
            padding: 10px 20px;
            font-size: 1.1em;
            color: #fff;
            background-color: #007bff;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            text-align: center;
            text-decoration: none;
        }

        .btn-save:hover {
            background-color: #0056b3;
        }
    </style>
</head>

<body>

    <h1>{{ user.username }}님의 마이페이지</h1>

    <div class="section">
        <h3>테스트 결과</h3>
        {% if test_result %}
        <p>결과 1: {{ test_result.result1 }}</p>
        <p>결과 2: {{ test_result.result2 }}</p>
        {% else %}
        <p>테스트를 진행해보세요.</p>
        {% endif %}
        <button class="btn-save" id="saveResultBtn">결과 저장</button>
    </div>

    <div class="section">
        <h3>내 관심종목 리스트</h3>
        <ul class="stock-list">
            {% for stock in stock_info %}
            <li>
                <span class="stock-code">{{ stock.stock_code }} - {{ stock.name }}</span>
                <span class="stock-price">{{ stock.current_price }}원</span>
                <span class="stock-rate">{{ stock.UpDownRate }}% ({{ stock.UpDownPoint }})</span>
            </li>
            {% endfor %}
        </ul>
    </div>

    <script>
        document.getElementById('saveResultBtn').addEventListener('click', function () {
            const resultTitle = '{{ test_result.result1 }}';
            const resultDescription = '{{ test_result.result2 }}';

            saveResult(resultTitle, resultDescription);
        });

        function saveResult(resultTitle, resultDescription) {
            const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value; // CSRF 토큰 추출

            fetch('/save-test-result/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': csrfToken
                },
                body: JSON.stringify({
                    result1: resultTitle,
                    result2: resultDescription
                })
            })
                .then(response => response.json())
                .then(data => {
                    console.log('Test result saved successfully:', data);
                })
                .catch(error => {
                    console.error('Error saving test result:', error);
                });
        }
    </script>

</body>

</html>