{% extends 'base.html' %}
{% load humanize %}
{% load static %}
    
{% block title %}ANTS-MyPage{% endblock %}

{% block content %}
<div class="mypage">
    <div class="container-leri" style="display: flex; justify-content: space-between; gap: 2rem;">
        <!-- Left Section -->
        <div class="left" style="flex: 1;">
            <h2 class="title" style="color: #2c662d;">My 관심종목</h2>
            <div class="container-fvl" style="padding: 20px; background-color: rgba(237, 255, 237, 0.8); border-radius: 10px;">
                {% if my_list %}
                <table class="table-stockinfo" style="width: 100%; border-collapse: collapse;">
                    <thead>
                        <tr style="border-bottom: 2px solid #2c662d;">
                            <th style="text-align: left;">종목명</th>
                            <th style="text-align: center;">MBTI</th>
                            <th style="text-align: right;">현재가</th>
                            <th style="text-align: right;">등락률</th>
                            <th style="text-align: center;">관심</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for stock in stock_info %}
                        <tr style="border-bottom: 1.8px solid #99c27c;">
                            <td style="text-align: left;">{{ stock.name }}</td>
                            <td style="text-align: center;">{{ stock.mbti|default:"정보없음" }}</td>
                            <td style="text-align: right;">{{ stock.current_price|intcomma }}</td>
                            <td style="text-align: right;">
                            {% if stock.UpDownRate > 0 %}
                                <span style="color: red;">{{ stock.UpDownPoint|intcomma }} ({{ stock.UpDownRate }}%)</span>
                            {% elif stock.UpDownRate == 0 %}
                                <span>{{ stock.UpDownPoint|intcomma }} ({{ stock.UpDownRate }}%)</span>
                            {% else %}
                                <span style="color: blue;">{{ stock.UpDownPoint|intcomma }} ({{ stock.UpDownRate }}%)</span>
                            {% endif %}
                            </td>
                            <td style="text-align: center;">
                                <a href="{% url 'remove_stock' stock.stock_code %}">
                                  <img src="{% static 'images/star.png' %}" alt="Remove" style="width: 25px; margin-top: 5px;"/>
                                </a>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                {% else %}
                <span style="font-size: 20px; display: block; text-align: center;"> <b>아직 관심있게 보고 계신 종목이 없으시군요!<br>별을 눌러 추가해보세요</b> </span>
                {% endif %}
            </div>
        </div>
        
        <!-- Right Section -->
        <div class="right" style="flex: 0.8;">
            <!-- First Box -->
            <div class="small-box" style="background-color: rgba(207, 255, 214, 0.6); font-size: 14px; word-wrap: break-word; overflow: hidden; text-align: center; padding: 20px; border-radius: 10px; margin-bottom: 15px;">
                {% if test_result1.result1 %}
                    <h3 style="font-size: 18px; color: #2c662d;"> {{ request.user.username }}님은 {{ test_result1.result1 }}이시네요! </h3>
                    <p>{{ test_result1.result2 }}</p>
                    <a href="{% url 'test_option_1' %}" class="btn btn-light" style="background-color: rgba(99, 172, 109, 0.9); color: white; padding: 10px 20px; margin-top: 10px;">테스트 다시하기</a>
                {% else %}
                    <p>{{ request.user.username }}님은 아직 테스트 전이시네요!</p>
                    <a href="{% url 'test_option_1' %}" class="btn btn-light" style="background-color: rgba(99, 172, 109, 0.9); color: white; padding: 10px 20px; margin-top: 10px;">나의 투자성향은?</a>
                {% endif %}
            </div>

            <!-- Second Box -->
            <div class="small-box" style="background-color: rgba(191, 219, 186, 0.6); font-size: 14px; word-wrap: break-word; overflow: hidden; text-align: center; padding: 20px; border-radius: 10px;">
                {% if test_result2.result1 %}
                    <h3 style="font-size: 18px; color: #2c662d;">{{ request.user.username }}님은 {{ test_result2.result1 }}이시네요!</h3>
                    <p>{{ test_result2.result2 }}</p>
                    <a href="{% url 'test_option_2' %}" class="btn btn-light" style="background-color: rgba(99, 172, 109, 0.9); color: white; padding: 10px 20px; margin-top: 10px;">테스트 다시하기</a>
                {% else %}
                    <p>{{ request.user.username }}님은 아직 테스트 전이시네요!</p>
                    <a href="{% url 'test_option_2' %}" class="btn btn-light" style="background-color: rgba(99, 172, 109, 0.9); color: white; padding: 10px 20px; margin-top: 10px;">나의 투자지식 테스트</a>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Bottom Section -->
    <div class="bottom" style="margin-top: 30px;">
        <div class="mbti-stock-rec" style="padding: 20px; background-color: rgba(243, 255, 237, 0.8); border-radius: 10px;">
            {% if my_list|length >= 5 %}
                <h5 style="color: #2c662d;">{{ request.user.username }}님이 가장 선호하시는 MBTI는 <strong>{{ mbti }}</strong>네요.</h5>
                <p>{{ mbti }}의 기업은 ~~ 기능이 있어요 ^^~</p>

                <div class="mbti-stock">
                    <table class="table-mbtistock" style="width: 100%; border-collapse: collapse; margin-top: 15px;">
                        <thead>
                            <tr style="border-bottom: 2px solid #2c662d;">
                                <th style="text-align: left;">종목명</th>
                                <th style="text-align: right;">현재가</th>
                                <th style="text-align: right;">등락률</th>
                                <th style="text-align: center;">관심</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for stocks in mbti_stock|slice:":5" %}
                            <tr style="border-bottom: 1.8px solid #99c27c;">
                                <td style="text-align: left;">{{ stocks.name }}</td>
                                <td style="text-align: right;">{{ stocks.current_price|intcomma }}</td>
                                <td style="text-align: right;">
                                {% if stocks.UpDownRate > 0 %}
                                    <span style="color: red;">{{ stocks.UpDownPoint|intcomma }} ({{ stocks.UpDownRate }}%)</span>
                                {% elif stocks.UpDownRate == 0 %}
                                    <span>{{ stocks.UpDownPoint|intcomma }} ({{ stocks.UpDownRate }}%)</span>
                                {% else %}
                                    <span style="color: blue;">{{ stocks.UpDownPoint|intcomma }} ({{ stocks.UpDownRate }}%)</span>
                                {% endif %}
                                </td>
                                <td style="text-align: center;">
                                    <a href="{% url 'remove_stock' stocks.stock_code %}">
                                        <img src="{% static 'images/star.png' %}" alt="Remove" style="width: 25px;"/>
                                    </a>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% else %}
            <span style="font-size: 20px; display: block; text-align: center; margin-top: 20px;">관심종목을 5개 이상 추가하시면 내가 선호하는 기업과 비슷한 기업을 보여드려요!</span>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}
